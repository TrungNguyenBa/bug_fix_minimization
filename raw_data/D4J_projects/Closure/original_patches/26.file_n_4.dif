diff --git a/test/com/google/javascript/jscomp/ProcessCommonJSModulesTest.java b/test/com/google/javascript/jscomp/ProcessCommonJSModulesTest.java
index 7525531c..4f6f0538 100644
--- a/test/com/google/javascript/jscomp/ProcessCommonJSModulesTest.java
+++ b/test/com/google/javascript/jscomp/ProcessCommonJSModulesTest.java
@@ -43,7 +43,9 @@ public class ProcessCommonJSModulesTest extends CompilerTestCase {
         "var module$test = {};" +
         "goog.require('module$name');" +
         "var name$$module$test = module$name;" +
-        "name$$module$test();");
+        "name$$module$test();" +
+        "if(module$test.module$exports)" +
+        "module$test=module$test.module$exports");
     setFilename("test/sub");
     test(
         "var name = require('mod/name');" +
@@ -52,7 +54,9 @@ public class ProcessCommonJSModulesTest extends CompilerTestCase {
         "var module$test$sub = {};" +
         "goog.require('module$mod$name');" +
         "var name$$module$test$sub = module$mod$name;" +
-        "(function() { name$$module$test$sub(); })();");
+        "(function() { name$$module$test$sub(); })();" +
+        "if(module$test$sub.module$exports)" +
+        "module$test$sub=module$test$sub.module$exports");
   }
 
   public void testExports() {
@@ -64,7 +68,9 @@ public class ProcessCommonJSModulesTest extends CompilerTestCase {
         "var module$test = {};" +
         "goog.require('module$name');" +
         "var name$$module$test = module$name;" +
-        "module$test.foo = 1;");
+        "module$test.foo = 1;" +
+        "if(module$test.module$exports)" +
+        "module$test=module$test.module$exports");
     test(
         "var name = require('name');" +
         "module.exports = function() {};",
@@ -85,7 +91,9 @@ public class ProcessCommonJSModulesTest extends CompilerTestCase {
         "goog.provide('module$test');" +
         "var module$test = {};" +
         "var a$$module$test = 1, b$$module$test = 2;" +
-        "(function() { var a; b$$module$test = 4})();");
+        "(function() { var a; b$$module$test = 4})();" +
+        "if(module$test.module$exports)" +
+        "module$test=module$test.module$exports");
   }
 
   public void testDash() {
@@ -96,7 +104,9 @@ public class ProcessCommonJSModulesTest extends CompilerTestCase {
         "var module$test_test = {};" +
         "goog.require('module$name');" +
         "var name$$module$test_test = module$name;" +
-        "module$test_test.foo = 1;");
+        "module$test_test.foo = 1;" +
+        "if(module$test_test.module$exports)" +
+        "module$test_test=module$test_test.module$exports");
   }
 
   public void testModuleName() {
@@ -115,13 +125,17 @@ public class ProcessCommonJSModulesTest extends CompilerTestCase {
         "var name = require('name');",
         "goog.provide('module$foo$bar'); var module$foo$bar = {};" +
         "goog.require('module$name');" +
-        "var name$$module$foo$bar = module$name;");
+        "var name$$module$foo$bar = module$name;" +
+        "if(module$foo$bar.module$exports)" +
+        "module$foo$bar=module$foo$bar.module$exports");
     test(
         "var name = require('./name');",
         "goog.provide('module$foo$bar');" +
         "var module$foo$bar = {};" +
         "goog.require('module$foo$name');" +
-        "var name$$module$foo$bar = module$foo$name;");
+        "var name$$module$foo$bar = module$foo$name;" +
+        "if(module$foo$bar.module$exports)" +
+        "module$foo$bar=module$foo$bar.module$exports");
 
   }
 
